#!/usr/bin/env python3
import sys
import requests
import subprocess

def busca_radio(nome):
    print(f"\nğŸ” Buscando estaÃ§Ãµes para: {nome}...")
    # Busca atÃ© 10 resultados para dar opÃ§Ã£o
    url = f"https://de1.api.radio-browser.info/json/stations/byname/{nome}?limit=10"
    
    try:
        response = requests.get(url, timeout=5)
        radios = response.json()
        
        if not radios:
            print(f"âŒ Nenhuma rÃ¡dio encontrada com o nome: {nome}")
            return

        print("\n--- ğŸ“» ESTAÃ‡Ã•ES ENCONTRADAS ---")
        for i, radio in enumerate(radios, 1):
            estado = radio.get('state', 'N/A')
            pais = radio.get('countrycode', '??')
            print(f"[{i}] {radio['name']} ({estado} - {pais})")
        
        print("\n[0] Cancelar")
        print("-------------------------------")
        
        try:
            escolha = int(input("\nğŸ‘‰ Digite o nÃºmero da rÃ¡dio: "))
            
            if escolha == 0:
                print("Cancelado.")
                return
            
            if 1 <= escolha <= len(radios):
                selecionada = radios[escolha-1]
                print(f"\nâœ… Selecionado: {selecionada['name']}")
                print(f"ğŸš€ Iniciando transmissÃ£o...")
                
                # Para qualquer player anterior e inicia o novo
                subprocess.run(["sudo", "killall", "-9", "mpv"], stderr=subprocess.DEVNULL)
                subprocess.run(["mpv", "--no-video", selecionada['url_resolved']])
            else:
                print("âŒ OpÃ§Ã£o invÃ¡lida.")
        except ValueError:
            print("âŒ Digite apenas nÃºmeros.")

    except Exception as e:
        print(f"âš ï¸ Erro na conexÃ£o: {e}")

if __name__ == "__main__":
    if len(sys.argv) > 1:
        busca_radio(" ".join(sys.argv[1:]))
    else:
        print("Uso: play-radio-busca <nome da radio>")
